<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación Digital - Big Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .slide-in-left {
            animation: slideInLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .slide-in-right {
            animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .bounce-in {
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .pulse-correct {
            animation: pulseGreen 1s ease-in-out;
        }
        .pulse-incorrect {
            animation: pulseRed 1s ease-in-out;
        }
        @keyframes pulseGreen {
            0% { background-color: rgb(34, 197, 94); transform: scale(1); }
            25% { background-color: rgb(22, 163, 74); transform: scale(1.02); }
            50% { background-color: rgb(34, 197, 94); transform: scale(1); }
            75% { background-color: rgb(22, 163, 74); transform: scale(1.02); }
            100% { background-color: rgb(34, 197, 94); transform: scale(1); }
        }
        @keyframes pulseRed {
            0% { background-color: rgb(239, 68, 68); transform: scale(1); }
            25% { background-color: rgb(220, 38, 38); transform: scale(1.02); }
            50% { background-color: rgb(239, 68, 68); transform: scale(1); }
            75% { background-color: rgb(220, 38, 38); transform: scale(1.02); }
            100% { background-color: rgb(239, 68, 68); transform: scale(1); }
        }
        
        .hangman-letter {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }
        .hangman-letter:hover:not(:disabled) {
            transform: scale(1.15) translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .hangman-letter:active {
            transform: scale(0.95);
        }
        
        .connection-line {
            stroke: #3b82f6;
            stroke-width: 3;
            fill: none;
            opacity: 0.8;
            stroke-dasharray: 5, 5;
            animation: dash 1s linear infinite;
        }
        @keyframes dash {
            to { stroke-dashoffset: -10; }
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .button-primary {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }
        .button-primary:active {
            transform: translateY(0);
        }
        
        .option-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        .option-card:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        .option-card.selected {
            transform: translateX(8px) scale(1.02);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }
        
        .concept-item, .definition-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        .concept-item:hover, .definition-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        .concept-item.selected {
            transform: translateY(-2px) scale(1.02);
        }
        
        .timer-pulse {
            animation: timerPulse 2s ease-in-out infinite;
        }
        @keyframes timerPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
        }
        
        .loading-dots::after {
            content: '';
            animation: loadingDots 1.5s steps(4, end) infinite;
        }
        @keyframes loadingDots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
            to { box-shadow: 0 0 30px rgba(59, 130, 246, 0.8); }
        }

        /* Protección contra selección y menú contextual */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        /* Estilos responsivos mejorados */
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .text-5xl {
                font-size: 2.5rem;
            }
            
            .text-3xl {
                font-size: 1.875rem;
            }
            
            .text-2xl {
                font-size: 1.5rem;
            }
            
            .grid-cols-6 {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }
            
            .hangman-letter {
                padding: 0.5rem 0.25rem;
                font-size: 0.875rem;
            }
            
            .option-card {
                padding: 1rem;
            }
            
            .option-card:hover {
                transform: none;
            }
            
            .card-hover:hover {
                transform: none;
            }
        }

        @media (max-width: 640px) {
            .text-4xl {
                font-size: 1.875rem;
            }
            
            .p-10 {
                padding: 1.5rem;
            }
            
            .p-8 {
                padding: 1.5rem;
            }
            
            .grid-cols-4 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        /* Estilos para pantalla de autenticación */
        .auth-screen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .password-input {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #6b7280;
        }

        .password-toggle:hover {
            color: #374151;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-sans">
    <!-- Pantalla de Autenticación -->
    <div id="authScreen" class="auth-screen">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Acceso Seguro</h1>
                <p class="text-gray-600">Ingresa la clave para acceder a la evaluación</p>
            </div>
            
            <form onsubmit="authenticateUser(event)" class="space-y-6">
                <div class="password-input">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Clave de Acceso</label>
                    <input 
                        type="password" 
                        id="accessKey" 
                        class="w-full px-4 py-3 pr-12 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all duration-300"
                        placeholder="Ingresa la clave"
                        required
                    >
                    <span class="password-toggle" onclick="togglePasswordVisibility()">
                        <svg id="eyeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </span>
                </div>
                
                <button type="submit" class="w-full button-primary bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-xl">
                    <span class="flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                        </svg>
                        Ingresar
                    </span>
                </button>
            </form>
            
            <div id="authError" class="hidden mt-4 p-3 bg-red-100 border border-red-300 rounded-lg">
                <div class="flex items-center text-red-800">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Clave incorrecta. Inténtalo de nuevo.
                </div>
            </div>
        </div>
    </div>

    <!-- Cronómetro fijo -->
    <div id="timer" class="fixed top-4 right-4 bg-white shadow-xl rounded-xl px-4 py-2 md:px-6 md:py-3 z-50 timer-pulse border border-blue-100">
        <div class="flex items-center space-x-2 md:space-x-3">
            <div class="relative">
                <svg class="w-5 h-5 md:w-6 md:h-6 text-blue-600 animate-spin" style="animation-duration: 60s;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div class="absolute inset-0 w-5 h-5 md:w-6 md:h-6 border-2 border-blue-200 rounded-full animate-pulse"></div>
            </div>
            <div class="text-center">
                <span id="timeDisplay" class="font-mono text-lg md:text-xl font-bold text-gray-800 block">00:00</span>
                <span class="text-xs text-gray-500 font-medium hidden md:block">Tiempo</span>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-2 md:px-4 py-4 md:py-8 max-w-4xl">
        <!-- Pantalla de Inicio -->
        <div id="startScreen" class="hidden fade-in">
            <div class="bg-white rounded-2xl shadow-2xl p-6 md:p-10 text-center card-hover border border-gray-100">
                <div class="mb-6 md:mb-8 bounce-in">
                    <div class="inline-flex items-center justify-center w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4">
                        <svg class="w-8 h-8 md:w-10 md:h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <h1 class="text-3xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-3">Evaluación Digital</h1>
                    <h2 class="text-xl md:text-3xl text-blue-600 font-semibold">TECNOLOGÍAS PARA MANEJO MASIVO DE DATOS</h2>
                    <div class="w-24 h-1 bg-gradient-to-r from-blue-500 to-purple-500 mx-auto mt-4 rounded-full"></div>
                </div>
                
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 md:p-8 mb-6 md:mb-10 text-left slide-in-left border border-blue-100">
                    <div class="flex items-center mb-4 md:mb-6">
                        <div class="w-6 h-6 md:w-8 md:h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                            <svg class="w-3 h-3 md:w-4 md:h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg md:text-xl font-bold text-gray-800">Instrucciones Generales</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 md:mb-6">
                        <div class="bg-white rounded-lg p-3 md:p-4 border border-blue-200">
                            <div class="text-xl md:text-2xl mb-2">📝</div>
                            <h4 class="font-semibold text-blue-800 mb-1 text-sm md:text-base">Sección 1</h4>
                            <p class="text-xs md:text-sm text-gray-600">10 preguntas de opción múltiple</p>
                            <p class="text-lg font-bold text-blue-600">30%</p>
                        </div>
                        <div class="bg-white rounded-lg p-3 md:p-4 border border-green-200">
                            <div class="text-xl md:text-2xl mb-2">🔗</div>
                            <h4 class="font-semibold text-green-800 mb-1 text-sm md:text-base">Sección 2</h4>
                            <p class="text-xs md:text-sm text-gray-600">Relacionar conceptos</p>
                            <p class="text-lg font-bold text-green-600">30%</p>
                        </div>
                        <div class="bg-white rounded-lg p-3 md:p-4 border border-purple-200">
                            <div class="text-xl md:text-2xl mb-2">🎯</div>
                            <h4 class="font-semibold text-purple-800 mb-1 text-sm md:text-base">Sección 3</h4>
                            <p class="text-xs md:text-sm text-gray-600">Juego del ahorcado</p>
                            <p class="text-lg font-bold text-purple-600">40%</p>
                        </div>
                    </div>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 md:p-4">
                        <div class="flex items-center">
                            <svg class="w-4 h-4 md:w-5 md:h-5 text-yellow-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-yellow-800 font-medium text-sm md:text-base">El cronómetro registra el tiempo total • Retroalimentación inmediata</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4 md:space-y-6 mb-6 md:mb-10 slide-in-right">
                    <div class="text-left">
                        <label class="flex items-center text-gray-700 font-semibold mb-3 text-sm md:text-base">
                            <svg class="w-4 h-4 md:w-5 md:h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Nombre Completo:
                        </label>
                        <input type="text" id="studentName" class="w-full px-4 md:px-6 py-3 md:py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all duration-300 text-base md:text-lg" placeholder="Ingresa tu nombre completo">
                    </div>
                    <div class="text-left">
                        <label class="flex items-center text-gray-700 font-semibold mb-3 text-sm md:text-base">
                            <svg class="w-4 h-4 md:w-5 md:h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            Grupo:
                        </label>
                        <input type="text" id="studentGroup" class="w-full px-4 md:px-6 py-3 md:py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all duration-300 text-base md:text-lg" placeholder="Ingresa tu grupo">
                    </div>
                </div>

                <button onclick="startEvaluation()" class="button-primary bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 md:py-4 px-8 md:px-12 rounded-xl text-lg md:text-xl shadow-lg w-full md:w-auto">
                    <span class="flex items-center justify-center">
                        <svg class="w-5 h-5 md:w-6 md:h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.01M15 10h1.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Comenzar Evaluación
                    </span>
                </button>
            </div>
        </div>

        <!-- Sección 1: Opción Múltiple -->
        <div id="section1" class="hidden fade-in">
            <div class="bg-white rounded-2xl shadow-2xl p-4 md:p-10 border border-gray-100">
                <div class="mb-6 md:mb-8">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                        <div class="flex items-center mb-4 md:mb-0">
                            <div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center mr-3 md:mr-4">
                                <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Sección 1</h2>
                                <p class="text-blue-600 font-semibold text-sm md:text-base">Opción Múltiple</p>
                            </div>
                        </div>
                        <div class="text-left md:text-right">
                            <div class="text-xl md:text-2xl font-bold text-blue-600">30%</div>
                            <div class="text-xs md:text-sm text-gray-500">Ponderación</div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-3 md:p-4 border border-blue-200">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                            <div class="flex items-center mb-3 md:mb-0">
                                <div class="w-6 h-6 md:w-8 md:h-8 bg-blue-500 rounded-full flex items-center justify-center mr-2 md:mr-3">
                                    <span id="currentQuestion" class="text-white font-bold text-sm md:text-base">1</span>
                                </div>
                                <span class="text-blue-800 font-semibold text-sm md:text-base">Pregunta <span id="currentQuestionText">1</span> de 10</span>
                            </div>
                            <div class="flex space-x-1">
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-blue-500 rounded-full"></div>
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-gray-300 rounded-full"></div>
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-gray-300 rounded-full"></div>
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-gray-300 rounded-full"></div>
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-gray-300 rounded-full"></div>
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-gray-300 rounded-full"></div>
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-gray-300 rounded-full"></div>
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-gray-300 rounded-full"></div>
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-gray-300 rounded-full"></div>
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-gray-300 rounded-full"></div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full progress-bar" style="width: 20%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="questionContainer" class="mb-6 md:mb-10">
                    <!-- Las preguntas se cargarán aquí -->
                </div>

                <div class="text-center">
                    <p class="text-gray-600 font-medium text-sm md:text-base">Selecciona tu respuesta para continuar automáticamente</p>
                </div>
            </div>
        </div>

        <!-- Sección 2: Relación de Columnas -->
        <div id="section2" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-xl p-4 md:p-8">
                <div class="mb-6">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-2">Sección 2: Relación de Columnas</h2>
                    <div class="bg-green-100 rounded-lg p-3">
                        <p class="text-green-800 font-medium text-sm md:text-base">Conecta cada concepto con su definición • Ponderación: 30%</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 mb-6 md:mb-8 relative">
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-4 text-sm md:text-base">Conceptos</h3>
                        <div id="conceptsColumn" class="space-y-3">
                            <!-- Los conceptos se cargarán aquí -->
                        </div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-4 text-sm md:text-base">Definiciones</h3>
                        <div id="definitionsColumn" class="space-y-3">
                            <!-- Las definiciones se cargarán aquí -->
                        </div>
                    </div>
                    <svg id="connectionSvg" class="absolute inset-0 pointer-events-none" style="z-index: 1;">
                        <!-- Las líneas de conexión se dibujarán aquí -->
                    </svg>
                </div>

                <div class="flex flex-col md:flex-row md:justify-between space-y-3 md:space-y-0">
                    <button onclick="clearConnections()" class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-6 rounded-lg transition-colors duration-200 w-full md:w-auto">
                        Limpiar Conexiones
                    </button>
                    <button onclick="finishSection2()" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-lg transition-colors duration-200 w-full md:w-auto">
                        Finalizar Sección
                    </button>
                </div>
            </div>
        </div>

        <!-- Sección 3: Ahorcado -->
        <div id="section3" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-xl p-4 md:p-8">
                <div class="mb-6">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-2">Sección 3: Juego del Ahorcado</h2>
                    <div class="bg-purple-100 rounded-lg p-3">
                        <p class="text-purple-800 font-medium text-sm md:text-base">Palabra <span id="currentWord">1</span> de 3 • Ponderación: 40%</p>
                    </div>
                </div>

                <div class="text-center mb-6 md:mb-8">
                    <div class="mb-4">
                        <p class="text-gray-600 mb-2 text-sm md:text-base">Pista:</p>
                        <p id="wordHint" class="text-base md:text-lg font-medium text-blue-600 bg-blue-50 rounded-lg p-3"></p>
                    </div>
                    
                    <div id="wordDisplay" class="text-2xl md:text-4xl font-mono font-bold text-gray-800 mb-4 md:mb-6 tracking-wider">
                        <!-- La palabra se mostrará aquí -->
                    </div>

                    <div class="mb-4 md:mb-6">
                        <p class="text-gray-600 mb-2 text-sm md:text-base">Intentos fallidos: <span id="wrongAttempts" class="font-bold text-red-600">0</span>/6</p>
                        <div class="flex justify-center">
                            <div id="hangmanDrawing" class="text-4xl md:text-6xl">
                                <!-- El dibujo del ahorcado aparecerá aquí -->
                            </div>
                        </div>
                    </div>

                    <div id="letterButtons" class="grid grid-cols-4 md:grid-cols-6 gap-2 max-w-md mx-auto mb-4 md:mb-6">
                        <!-- Los botones de letras se generarán aquí -->
                    </div>

                    <div class="flex flex-col md:flex-row justify-center space-y-3 md:space-y-0 md:space-x-4">
                        <button id="skipWordBtn" onclick="skipWord()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-6 rounded-lg transition-colors duration-200 w-full md:w-auto">
                            Saltar Palabra
                        </button>
                        <button id="nextWordBtn" onclick="nextWord()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-colors duration-200 hidden w-full md:w-auto">
                            Siguiente Palabra
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pantalla de Resultados -->
        <div id="resultsScreen" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-xl p-4 md:p-8 text-center">
                <div class="mb-6">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">🎉 Evaluación Completada</h2>
                    <div class="bg-gray-50 rounded-lg p-4 space-y-2">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-gray-700 text-sm md:text-base"><strong>Estudiante:</strong> <span id="finalName"></span></p>
                                <p class="text-gray-700 text-sm md:text-base"><strong>Grupo:</strong> <span id="finalGroup"></span></p>
                                <p class="text-gray-700 text-sm md:text-base"><strong>Tiempo total:</strong> <span id="finalTime"></span></p>
                            </div>
                            <div>
                                <p class="text-gray-700 text-sm md:text-base"><strong>Fecha:</strong> <span id="evaluationDate"></span></p>
                                <p class="text-gray-700 text-sm md:text-base"><strong>Hora:</strong> <span id="evaluationTime"></span></p>
                                <p class="text-gray-700 text-sm md:text-base"><strong>Profesor:</strong> <span id="professorName">MTI JERM</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8">
                    <div class="bg-blue-50 rounded-lg p-4 md:p-6">
                        <h3 class="font-semibold text-blue-800 mb-2 text-sm md:text-base">Sección 1</h3>
                        <p class="text-blue-600 text-sm">Opción Múltiple</p>
                        <p class="text-xl md:text-2xl font-bold text-blue-800" id="section1Score">0%</p>
                        <p class="text-xs md:text-sm text-blue-600">Ponderación: 30%</p>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 md:p-6">
                        <h3 class="font-semibold text-green-800 mb-2 text-sm md:text-base">Sección 2</h3>
                        <p class="text-green-600 text-sm">Relación de Columnas</p>
                        <p class="text-xl md:text-2xl font-bold text-green-800" id="section2Score">0%</p>
                        <p class="text-xs md:text-sm text-green-600">Ponderación: 30%</p>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4 md:p-6">
                        <h3 class="font-semibold text-purple-800 mb-2 text-sm md:text-base">Sección 3</h3>
                        <p class="text-purple-600 text-sm">Ahorcado</p>
                        <p class="text-xl md:text-2xl font-bold text-purple-800" id="section3Score">0%</p>
                        <p class="text-xs md:text-sm text-purple-600">Ponderación: 40%</p>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-4 md:p-6 text-white mb-6 md:mb-8">
                    <h3 class="text-lg md:text-xl font-semibold mb-2">Calificación Final</h3>
                    <p class="text-3xl md:text-4xl font-bold" id="finalScore">0%</p>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 mb-6">
                    <div class="flex items-center justify-center text-gray-600">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="font-medium">Evaluación completada exitosamente</span>
                    </div>
                    <p class="text-center text-sm text-gray-500 mt-2">Intento #<span id="attemptNumber">1</span></p>
                </div>

                <!-- Código QR de Verificación -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border-2 border-blue-200">
                    <div class="text-center mb-4">
                        <h3 class="text-lg font-bold text-blue-800 mb-2">📱 Código QR de Verificación</h3>
                        <p class="text-blue-600 text-sm">Prueba infalsificable de tu evaluación</p>
                    </div>
                    
                    <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-6">
                        <!-- Contenedor del QR -->
                        <div class="bg-white p-4 rounded-xl shadow-lg border border-gray-200">
                            <div id="qrcode" class="flex items-center justify-center"></div>
                        </div>
                        
                        <!-- Información del QR -->
                        <div class="text-center md:text-left">
                            <div class="bg-white rounded-lg p-4 border border-blue-200 max-w-xs">
                                <h4 class="font-semibold text-gray-800 mb-2">🔐 Datos Verificables</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>✓ Nombre y grupo del estudiante</li>
                                    <li>✓ Fecha y hora exacta</li>
                                    <li>✓ Calificaciones por sección</li>
                                    <li>✓ Tiempo total empleado</li>
                                    <li>✓ Hash de seguridad único</li>
                                </ul>
                            </div>
                            <p class="text-xs text-gray-500 mt-3 max-w-xs">
                                Este QR contiene un hash criptográfico que garantiza la autenticidad de los resultados
                            </p>
                        </div>
                    </div>
                    

                </div>
            </div>
        </div>
    </div>

    <script>
        // Protección contra inspección de código
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            showNotification('Función deshabilitada por seguridad', 'warning');
        });

        document.addEventListener('keydown', function(e) {
            // Deshabilitar F12, Ctrl+Shift+I, Ctrl+U, Ctrl+Shift+J
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
                (e.ctrlKey && e.key === 'U')) {
                e.preventDefault();
                showNotification('Función deshabilitada por seguridad', 'warning');
            }
        });

        // Variables globales
        let startTime;
        let timerInterval;
        let studentData = {};
        let currentQuestionIndex = 0;
        let section1Answers = [];
        let section2Connections = {};
        let section3Data = {
            currentWordIndex: 0,
            wordsCompleted: 0,
            totalAttempts: 0
        };
        let isProcessingAnswer = false;
        let shuffledQuestions = [];
        let questionMappings = [];
        let attemptCount = 0;

        // Sistema de control de intentos
        function getAttemptCount() {
            const stored = localStorage.getItem('evaluationAttempts');
            return stored ? parseInt(stored) : 0;
        }

        function incrementAttemptCount() {
            attemptCount = getAttemptCount() + 1;
            localStorage.setItem('evaluationAttempts', attemptCount.toString());
            return attemptCount;
        }

        function checkAttemptLimit() {
            const currentAttempts = getAttemptCount();
            if (currentAttempts >= 1) {
                showAttemptLimitMessage();
                return false;
            }
            return true;
        }

        function showAttemptLimitMessage() {
            const authScreen = document.getElementById('authScreen');
            authScreen.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4">
                    <div class="text-center">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-full mb-4">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-800 mb-4">Acceso Restringido</h1>
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                            <p class="text-red-800 font-medium mb-2">Ya has completado esta evaluación</p>
                            <p class="text-red-600 text-sm">Solo se permite un intento por estudiante</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-3">
                            <p class="text-gray-600 text-sm">Intentos realizados: <span class="font-bold">${currentAttempts}</span></p>
                        </div>
                    </div>
                </div>
            `;
        }

        // ====================================
        // CONFIGURACIÓN JSON DE LA EVALUACIÓN
        // ====================================
        
        /*
        INSTRUCCIONES PARA PERSONALIZAR LA EVALUACIÓN:
        
        1. INFORMACIÓN GENERAL:
           - title: Título principal de la evaluación
           - subtitle: Subtítulo o materia
           - professor: Nombre del profesor
           - accessKey: Clave de acceso (mantener segura)
        
        2. SECCIÓN 1 - PREGUNTAS DE OPCIÓN MÚLTIPLE:
           - name: Nombre de la sección
           - weight: Ponderación (porcentaje del 0-100)
           - questions: Array de preguntas con:
             * question: Texto de la pregunta
             * options: Array de 3 opciones (siempre 3)
             * correct: Índice de la respuesta correcta (0, 1, o 2)
             * explanation: Explicación de la respuesta correcta
        
        3. SECCIÓN 2 - RELACIÓN DE COLUMNAS:
           - name: Nombre de la sección
           - weight: Ponderación (porcentaje del 0-100)
           - pairs: Objeto con pares concepto-definición
             * Clave: Concepto
             * Valor: Definición correspondiente
        
        4. SECCIÓN 3 - JUEGO DEL AHORCADO:
           - name: Nombre de la sección
           - weight: Ponderación (porcentaje del 0-100)
           - words: Array de palabras con:
             * word: Palabra a adivinar (solo letras mayúsculas)
             * hint: Pista para ayudar al estudiante
        
        NOTAS IMPORTANTES:
        - La suma de weights debe ser 100
        - Puedes agregar o quitar preguntas, pares y palabras
        - Mantén el formato JSON válido
        - Las palabras del ahorcado deben estar en mayúsculas
        - Cada pregunta debe tener exactamente 3 opciones
        */
        
        const EVALUATION_CONFIG = {
            general: {
                title: "Evaluación Digital",
                subtitle: "TECNOLOGÍAS PARA MANEJO MASIVO DE DATOS",
                professor: "MTI JERM",
                accessKey: "Admin123.@"
            },
            
            section1: {
                name: "Opción Múltiple",
                weight: 30,
                questions: [
                    {
                        question: "Una empresa de comercio electrónico quiere analizar las tendencias de compra de sus clientes a largo plazo para predecir la demanda de productos en futuras temporadas. ¿Qué tipo de estructura de datos sería la más adecuada para este objetivo y por qué?",
                        options: [
                            "Una base de datos operativa, porque gestiona las transacciones diarias y ofrece datos actualizados al momento.",
                            "Un Data Warehouse, porque almacena datos históricos de múltiples fuentes, permitiendo el análisis de tendencias a lo largo del tiempo.",
                            "Un Data Lake, porque es ideal para almacenar grandes volúmenes de datos no estructurados como imágenes y videos sin un propósito de análisis inmediato."
                        ],
                        correct: 1,
                        explanation: "Un Data Warehouse es la estructura más adecuada porque está diseñado específicamente para almacenar datos históricos de múltiples fuentes y facilitar el análisis de tendencias a largo plazo."
                    },
                    {
                        question: "Si una organización necesita consolidar datos de ventas, marketing y atención al cliente provenientes de diferentes sistemas para obtener una visión unificada del negocio, ¿cuál es el primer desafío técnico fundamental que debe resolver?",
                        options: [
                            "La visualización de los datos, ya que representar gráficamente la información es el primer paso para su comprensión.",
                            "La selección de una arquitectura de procesamiento paralelo como Hadoop para manejar el gran volumen de información.",
                            "La integración y transformación de los datos, ya que provienen de múltiples fuentes y deben ser limpiados y estandarizados para ser coherentes y útiles para el análisis."
                        ],
                        correct: 2,
                        explanation: "La integración y transformación de datos es el primer desafío fundamental, ya que los datos de diferentes sistemas deben ser limpiados, estandarizados y unificados antes de cualquier análisis o visualización."
                    },
                    {
                        question: "Una startup de redes sociales está experimentando un crecimiento explosivo, generando terabytes de datos no estructurados (fotos, videos, logs) diariamente. ¿Qué enfoque tecnológico debería priorizar para gestionar este volumen y variedad de datos de manera eficiente?",
                        options: [
                            "Implementar un Data Warehouse tradicional para estructurar y organizar los datos inmediatamente, facilitando la generación de reportes.",
                            "Adoptar una arquitectura de Big Data con soluciones como Data Lakes, ya que están diseñadas para manejar grandes volúmenes de datos no estructurados y variados a alta velocidad.",
                            "Centrarse únicamente en el proceso ETL para limpiar los datos, ya que la calidad es más importante que la capacidad de almacenamiento."
                        ],
                        correct: 1,
                        explanation: "Una arquitectura de Big Data con Data Lakes es la más apropiada para manejar grandes volúmenes de datos no estructurados y variados, proporcionando la flexibilidad y escalabilidad necesarias."
                    },
                    {
                        question: "Una cadena de supermercados utiliza sensores de IoT en sus refrigeradores para monitorear la temperatura en tiempo real y evitar la pérdida de productos. ¿A qué fase del ciclo de vida de Big Data corresponde la acción de los sensores?",
                        options: [
                            "A la fase de Análisis, porque los datos se examinan para obtener conocimientos.",
                            "A la fase de Almacenamiento, porque los datos se guardan para su fácil acceso posterior.",
                            "A la fase de Generación/Recolección, ya que los sensores están creando y recopilando los datos crudos directamente desde la fuente."
                        ],
                        correct: 2,
                        explanation: "Los sensores IoT corresponden a la fase de Generación/Recolección, ya que son los dispositivos que crean y capturan los datos en tiempo real desde el entorno físico."
                    },
                    {
                        question: "Un banco quiere implementar un modelo de Machine Learning para detectar transacciones fraudulentas. La institución ya cuenta con un Data Warehouse que contiene años de datos transaccionales limpios y organizados. ¿Cuál es el rol principal del Data Warehouse en este proyecto?",
                        options: [
                            "Servir como una fuente de datos de alta calidad para entrenar los algoritmos de Machine Learning, ya que estos requieren grandes volúmenes de datos históricos y estructurados.",
                            "Reemplazar al modelo de Machine Learning, ya que las consultas optimizadas del Data Warehouse son suficientes para detectar fraudes.",
                            "Almacenar los resultados del modelo de Machine Learning únicamente, sin participar en su fase de entrenamiento."
                        ],
                        correct: 0,
                        explanation: "El Data Warehouse sirve como fuente de datos de alta calidad para entrenar los algoritmos de Machine Learning, proporcionando los datos históricos estructurados y limpios necesarios para el entrenamiento efectivo del modelo."
                    },
                    {
                        question: "Una empresa de marketing necesita realizar un análisis comparativo de los precios de sus competidores. ¿Qué técnica de recopilación de datos sería la más directa y eficiente para obtener esta información de múltiples sitios web de comercio electrónico?",
                        options: [
                            "Encuestas y cuestionarios enviados a los clientes para preguntarles sobre los precios que han visto.",
                            "Utilizar Web Scraping para extraer automáticamente los datos sobre precios directamente de las páginas web de la competencia.",
                            "Implementar sensores IoT en las tiendas físicas de los competidores para registrar los precios."
                        ],
                        correct: 1,
                        explanation: "El Web Scraping es la técnica más directa y eficiente para extraer automáticamente datos de precios de múltiples sitios web, permitiendo obtener información actualizada y precisa de forma sistemática."
                    },
                    {
                        question: "Al diseñar un sistema de gestión de datos, se decide implementar cargas incrementales en lugar de cargas completas para actualizar el Data Warehouse cada noche. ¿Cuál es la justificación estratégica detrás de esta decisión?",
                        options: [
                            "Asegurar que los datos nunca se modifiquen una vez cargados, cumpliendo con la característica de no volatilidad.",
                            "Optimizar el tiempo y los recursos del sistema, ya que solo se procesan los datos que han cambiado desde la última carga, minimizando el impacto en el rendimiento.",
                            "Facilitar la integración de datos de diversas fuentes al procesar todo el conjunto de datos cada vez para garantizar la coherencia."
                        ],
                        correct: 1,
                        explanation: "Las cargas incrementales optimizan significativamente el tiempo y los recursos del sistema al procesar únicamente los datos que han cambiado, reduciendo el tiempo de procesamiento y el impacto en el rendimiento del sistema."
                    },
                    {
                        question: "Una organización necesita alinear su estrategia de gestión de datos con sus objetivos empresariales. ¿Cuál de las siguientes consideraciones es la más crucial para lograr esta alineación?",
                        options: [
                            "Adoptar la tecnología más nueva y potente del mercado, independientemente del presupuesto.",
                            "Evaluar las necesidades específicas del negocio (escalabilidad, tipo de datos, seguridad) para seleccionar la tecnología que mejor soporte la estrategia empresarial.",
                            "Priorizar únicamente los costos y presupuestos para elegir la opción más económica disponible."
                        ],
                        correct: 1,
                        explanation: "La evaluación de las necesidades específicas del negocio es crucial para seleccionar la tecnología adecuada que realmente soporte los objetivos empresariales, considerando factores como escalabilidad, tipos de datos y requisitos de seguridad."
                    },
                    {
                        question: "En el contexto de un ecosistema tecnológico moderno, ¿cómo se complementan Big Data y el Data Warehouse para potenciar la toma de decisiones?",
                        options: [
                            "Se utilizan de forma excluyente: las empresas eligen Big Data para datos modernos y Data Warehouse para datos tradicionales, sin que interactúen.",
                            "El Data Warehouse es una tecnología obsoleta que ha sido completamente reemplazada por las arquitecturas de Big Data.",
                            "Big Data maneja la ingesta masiva de datos variados y no estructurados, que luego pueden ser procesados, estructurados y cargados en un Data Warehouse para un análisis profundo y eficiente."
                        ],
                        correct: 2,
                        explanation: "Big Data y Data Warehouse se complementan perfectamente: Big Data maneja la ingesta y procesamiento inicial de grandes volúmenes de datos variados, mientras que el Data Warehouse proporciona una estructura optimizada para análisis profundos y consultas eficientes."
                    },
                    {
                        question: "Una empresa de logística quiere analizar el rendimiento de sus rutas de entrega. Para ello, combina datos de GPS (semi-estructurados), comentarios de los conductores (no estructurados) y registros de entrega de su base de datos (estructurados). ¿Qué concepto describe mejor este escenario de datos?",
                        options: [
                            "Un Data Mart, ya que se enfoca en un subconjunto de datos para un área específica como la logística.",
                            "Big Data, caracterizado por la gestión de conjuntos de datos complejos que destacan por su Volumen, Variedad (estructurados, no estructurados) y Velocidad.",
                            "Modelado dimensional, porque se están organizando los datos en torno a hechos y dimensiones para el análisis."
                        ],
                        correct: 1,
                        explanation: "Este escenario representa claramente Big Data debido a la combinación de diferentes tipos de datos (estructurados, semi-estructurados y no estructurados) que requieren procesamiento especializado para manejar su variedad y complejidad."
                    }
                ]
            },
            
            section2: {
                name: "Relación de Columnas",
                weight: 30,
                pairs: {
                    "Hadoop": "Framework de código abierto para procesamiento distribuido de grandes conjuntos de datos",
                    "Data Mining": "Proceso de extracción de patrones y conocimientos útiles de grandes conjuntos de datos",
                    "NoSQL": "Bases de datos no relacionales diseñadas para manejar grandes volúmenes de datos no estructurados",
                    "ETL": "Proceso de Extraer, Transformar y Cargar datos desde múltiples fuentes hacia un destino",
                    "Data Lake": "Repositorio centralizado que permite almacenar datos estructurados y no estructurados a cualquier escala"
                }
            },
            
            section3: {
                name: "Juego del Ahorcado",
                weight: 40,
                words: [
                    { word: "ANALYTICS", hint: "Proceso de examinar datos para obtener conclusiones y patrones útiles" },
                    { word: "CLUSTER", hint: "Grupo de computadoras trabajando juntas como un sistema unificado" },
                    { word: "STREAMING", hint: "Procesamiento de datos en tiempo real conforme van llegando" }
                ]
            }
        };

        // Funciones de autenticación
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('accessKey');
            const eyeIcon = document.getElementById('eyeIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
                `;
            } else {
                passwordInput.type = 'password';
                eyeIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                `;
            }
        }

        function authenticateUser(event) {
            event.preventDefault();
            const accessKey = document.getElementById('accessKey').value;
            const correctKey = EVALUATION_CONFIG.general.accessKey;
            
            if (accessKey === correctKey) {
                // Verificar límite de intentos antes de permitir acceso
                if (!checkAttemptLimit()) {
                    return;
                }
                
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('startScreen').classList.remove('hidden');
                showNotification('¡Acceso autorizado! Bienvenido a la evaluación.', 'success');
            } else {
                const errorDiv = document.getElementById('authError');
                errorDiv.classList.remove('hidden');
                document.getElementById('accessKey').classList.add('shake', 'border-red-400');
                
                setTimeout(() => {
                    document.getElementById('accessKey').classList.remove('shake', 'border-red-400');
                    document.getElementById('accessKey').value = '';
                }, 1000);
            }
        }

        // Funciones del cronómetro
        function startTimer() {
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const now = new Date();
            const elapsed = Math.floor((now - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timeDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function stopTimer() {
            clearInterval(timerInterval);
            const elapsed = Math.floor((new Date() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Función para mezclar preguntas y respuestas
        function shuffleQuestionsAndAnswers() {
            // Crear una copia de las preguntas originales del JSON
            const originalQuestions = [...EVALUATION_CONFIG.section1.questions];
            
            // Mezclar el orden de las preguntas
            shuffledQuestions = originalQuestions.sort(() => Math.random() - 0.5);
            
            // Para cada pregunta, mezclar las opciones y mantener el mapeo de la respuesta correcta
            questionMappings = shuffledQuestions.map((question, questionIndex) => {
                const originalOptions = [...question.options];
                const originalCorrect = question.correct;
                
                // Crear array de índices y mezclarlos
                const optionIndices = [0, 1, 2];
                const shuffledIndices = optionIndices.sort(() => Math.random() - 0.5);
                
                // Crear las opciones mezcladas
                const shuffledOptions = shuffledIndices.map(index => originalOptions[index]);
                
                // Encontrar la nueva posición de la respuesta correcta
                const newCorrectIndex = shuffledIndices.indexOf(originalCorrect);
                
                return {
                    question: question.question,
                    options: shuffledOptions,
                    correct: newCorrectIndex,
                    explanation: question.explanation,
                    originalIndex: EVALUATION_CONFIG.section1.questions.indexOf(question)
                };
            });
        }

        // Función para iniciar la evaluación
        function startEvaluation() {
            const name = document.getElementById('studentName').value.trim();
            const group = document.getElementById('studentGroup').value.trim();
            
            if (!name || !group) {
                const emptyFields = [];
                if (!name) emptyFields.push('nombre');
                if (!group) emptyFields.push('grupo');
                
                showNotification(`Por favor, completa tu ${emptyFields.join(' y ')} antes de continuar.`, 'warning');
                
                // Resaltar campos vacíos
                if (!name) {
                    const nameField = document.getElementById('studentName');
                    nameField.classList.add('shake', 'border-red-400');
                    setTimeout(() => {
                        nameField.classList.remove('shake', 'border-red-400');
                    }, 500);
                }
                if (!group) {
                    const groupField = document.getElementById('studentGroup');
                    groupField.classList.add('shake', 'border-red-400');
                    setTimeout(() => {
                        groupField.classList.remove('shake', 'border-red-400');
                    }, 500);
                }
                return;
            }

            // Efecto de transición suave
            const startScreen = document.getElementById('startScreen');
            const section1 = document.getElementById('section1');
            
            startScreen.style.transform = 'translateX(-100%)';
            startScreen.style.opacity = '0';
            
            setTimeout(() => {
                studentData = { name, group };
                startScreen.classList.add('hidden');
                startScreen.style.transform = '';
                startScreen.style.opacity = '';
                
                section1.classList.remove('hidden');
                section1.style.transform = 'translateX(100%)';
                section1.style.opacity = '0';
                
                setTimeout(() => {
                    section1.style.transform = '';
                    section1.style.opacity = '';
                }, 50);
                
                shuffleQuestionsAndAnswers();
                startTimer();
                loadQuestion();
                showNotification('¡Evaluación iniciada! ¡Mucho éxito!', 'success');
            }, 300);
        }

        // Funciones de la Sección 1
        function loadQuestion() {
            const question = questionMappings[currentQuestionIndex];
            const container = document.getElementById('questionContainer');
            
            container.innerHTML = `
                <div class="mb-6 md:mb-8 slide-in-left">
                    <div class="bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl p-4 md:p-6 mb-4 md:mb-6 border border-gray-200">
                        <h3 class="text-lg md:text-2xl font-bold text-gray-800 mb-2">${question.question}</h3>
                        <p class="text-gray-600 text-sm md:text-base">Selecciona la respuesta correcta:</p>
                    </div>
                    <div class="space-y-3 md:space-y-4">
                        ${question.options.map((option, index) => `
                            <label class="option-card flex items-start p-4 md:p-6 border-2 border-gray-200 rounded-xl hover:border-blue-300 cursor-pointer group">
                                <div class="flex items-center justify-center w-6 h-6 md:w-8 md:h-8 border-2 border-gray-300 rounded-full mr-3 md:mr-4 group-hover:border-blue-500 transition-colors duration-200 flex-shrink-0 mt-1">
                                    <input type="radio" name="question${currentQuestionIndex}" value="${index}" class="sr-only" onchange="selectOption(this)">
                                    <div class="w-3 h-3 md:w-4 md:h-4 bg-blue-500 rounded-full opacity-0 transform scale-0 transition-all duration-200"></div>
                                </div>
                                <span class="text-sm md:text-lg text-gray-700 group-hover:text-gray-900 font-medium">${option}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
                <div id="feedback" class="hidden rounded-xl mb-6"></div>
            `;

            // Actualizar indicadores de progreso
            updateProgressIndicators();
            isProcessingAnswer = false;
        }

        function selectOption(input) {
            if (isProcessingAnswer) return;
            isProcessingAnswer = true;

            // Remover selección previa
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
                const circle = card.querySelector('div div');
                circle.classList.remove('opacity-100', 'scale-100');
                circle.classList.add('opacity-0', 'scale-0');
            });
            
            // Agregar selección actual
            const selectedCard = input.closest('.option-card');
            selectedCard.classList.add('selected', 'border-blue-500', 'bg-blue-50');
            const circle = selectedCard.querySelector('div div');
            circle.classList.remove('opacity-0', 'scale-0');
            circle.classList.add('opacity-100', 'scale-100');
            
            // Procesar respuesta automáticamente después de un breve delay
            setTimeout(() => {
                processAnswer();
            }, 800);
        }

        function processAnswer() {
            const selected = document.querySelector(`input[name="question${currentQuestionIndex}"]:checked`);
            
            if (!selected) {
                isProcessingAnswer = false;
                return;
            }

            const answer = parseInt(selected.value);
            const question = questionMappings[currentQuestionIndex];
            const feedback = document.getElementById('feedback');
            
            // Deshabilitar todas las opciones
            document.querySelectorAll('.option-card').forEach(card => {
                card.style.pointerEvents = 'none';
            });
            
            // Mostrar retroalimentación mejorada
            feedback.classList.remove('hidden');
            if (answer === question.correct) {
                feedback.className = 'p-4 md:p-6 rounded-xl mb-6 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 pulse-correct';
                feedback.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-10 h-10 md:w-12 md:h-12 bg-green-500 rounded-full flex items-center justify-center mr-3 md:mr-4">
                            <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <h4 class="text-lg md:text-xl font-bold text-green-800 mb-2">¡Excelente! Respuesta Correcta</h4>
                            <p class="text-green-700 text-sm md:text-lg">${question.explanation}</p>
                        </div>
                    </div>
                `;
            } else {
                feedback.className = 'p-4 md:p-6 rounded-xl mb-6 bg-gradient-to-r from-red-50 to-pink-50 border-2 border-red-200 pulse-incorrect';
                feedback.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-10 h-10 md:w-12 md:h-12 bg-red-500 rounded-full flex items-center justify-center mr-3 md:mr-4">
                            <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </div>
                        <div>
                            <h4 class="text-lg md:text-xl font-bold text-red-800 mb-2">Respuesta Incorrecta</h4>
                            <p class="text-red-700 text-sm md:text-lg mb-2">${question.explanation}</p>
                            <p class="text-red-600 font-medium text-sm md:text-base">La respuesta correcta era: ${question.options[question.correct]}</p>
                        </div>
                    </div>
                `;
            }

            section1Answers[currentQuestionIndex] = answer;

            // Mostrar botón de continuar después de un delay
            setTimeout(() => {
                const continueBtn = document.createElement('button');
                continueBtn.className = 'button-primary bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 px-6 md:px-8 rounded-xl mt-4 w-full md:w-auto';
                continueBtn.innerHTML = `
                    <span class="flex items-center justify-center">
                        ${currentQuestionIndex < EVALUATION_CONFIG.section1.questions.length - 1 ? 'Siguiente Pregunta' : 'Ir a Sección 2'}
                        <svg class="w-4 h-4 md:w-5 md:h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </span>
                `;
                continueBtn.onclick = () => {
                    if (currentQuestionIndex < EVALUATION_CONFIG.section1.questions.length - 1) {
                        currentQuestionIndex++;
                        loadQuestion();
                    } else {
                        // Ir a la sección 2
                        document.getElementById('section1').classList.add('hidden');
                        document.getElementById('section2').classList.remove('hidden');
                        initSection2();
                    }
                };
                
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'text-center md:text-left';
                buttonContainer.appendChild(continueBtn);
                feedback.appendChild(buttonContainer);
            }, 1000);
        }

        function updateProgressIndicators() {
            const progressDots = document.querySelectorAll('.flex.space-x-1 > div');
            const progressBar = document.getElementById('progressBar');
            
            // Actualizar puntos de progreso
            progressDots.forEach((dot, index) => {
                if (index <= currentQuestionIndex) {
                    dot.className = 'w-2 h-2 md:w-3 md:h-3 bg-blue-500 rounded-full';
                } else {
                    dot.className = 'w-2 h-2 md:w-3 md:h-3 bg-gray-300 rounded-full';
                }
            });
            
            // Actualizar barra de progreso
            const progress = ((currentQuestionIndex + 1) / EVALUATION_CONFIG.section1.questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Actualizar texto
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('currentQuestionText').textContent = currentQuestionIndex + 1;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = type === 'warning' ? 'bg-yellow-100 border-yellow-300 text-yellow-800' :
                           type === 'error' ? 'bg-red-100 border-red-300 text-red-800' :
                           type === 'success' ? 'bg-green-100 border-green-300 text-green-800' :
                           'bg-blue-100 border-blue-300 text-blue-800';
            
            notification.className = `fixed top-20 right-4 z-50 p-3 md:p-4 rounded-xl shadow-lg max-w-sm transform translate-x-full transition-transform duration-300 ${bgColor} border`;
            notification.innerHTML = `
                <div class="flex items-center text-sm md:text-base">
                    <svg class="w-4 h-4 md:w-5 md:h-5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Funciones de la Sección 2
        function initSection2() {
            const concepts = Object.keys(EVALUATION_CONFIG.section2.pairs);
            const definitions = Object.values(EVALUATION_CONFIG.section2.pairs);
            
            // Mezclar las definiciones
            const shuffledDefinitions = [...definitions].sort(() => Math.random() - 0.5);
            
            const conceptsContainer = document.getElementById('conceptsColumn');
            const definitionsContainer = document.getElementById('definitionsColumn');
            
            conceptsContainer.innerHTML = concepts.map((concept, index) => `
                <div class="concept-item bg-blue-100 border border-blue-300 rounded-lg p-3 md:p-4 cursor-pointer hover:bg-blue-200 transition-colors duration-200 text-sm md:text-base" 
                     data-concept="${concept}" data-index="${index}">
                    ${concept}
                </div>
            `).join('');
            
            definitionsContainer.innerHTML = shuffledDefinitions.map((definition, index) => `
                <div class="definition-item bg-green-100 border border-green-300 rounded-lg p-3 md:p-4 cursor-pointer hover:bg-green-200 transition-colors duration-200 text-sm md:text-base" 
                     data-definition="${definition}" data-index="${index}">
                    ${definition}
                </div>
            `).join('');

            // Agregar event listeners
            let selectedConcept = null;
            
            document.querySelectorAll('.concept-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.concept-item').forEach(c => c.classList.remove('ring-2', 'ring-blue-500'));
                    item.classList.add('ring-2', 'ring-blue-500');
                    selectedConcept = item.dataset.concept;
                });
            });
            
            document.querySelectorAll('.definition-item').forEach(item => {
                item.addEventListener('click', () => {
                    if (selectedConcept) {
                        section2Connections[selectedConcept] = item.dataset.definition;
                        item.classList.add('bg-yellow-200', 'border-yellow-400');
                        document.querySelector(`[data-concept="${selectedConcept}"]`).classList.add('bg-yellow-200', 'border-yellow-400');
                        selectedConcept = null;
                        document.querySelectorAll('.concept-item').forEach(c => c.classList.remove('ring-2', 'ring-blue-500'));
                        updateConnectionLines();
                    }
                });
            });
        }

        function updateConnectionLines() {
            // Esta función podría dibujar líneas SVG entre elementos conectados
            // Por simplicidad, usamos colores para mostrar las conexiones
        }

        function clearConnections() {
            section2Connections = {};
            document.querySelectorAll('.concept-item, .definition-item').forEach(item => {
                item.classList.remove('bg-yellow-200', 'border-yellow-400', 'ring-2', 'ring-blue-500');
            });
        }

        function finishSection2() {
            document.getElementById('section2').classList.add('hidden');
            document.getElementById('section3').classList.remove('hidden');
            initSection3();
        }

        // Funciones de la Sección 3
        function initSection3() {
            section3Data.currentWordIndex = 0;
            section3Data.wordsCompleted = 0;
            section3Data.totalAttempts = 0;
            loadHangmanWord();
        }

        function loadHangmanWord() {
            const wordData = EVALUATION_CONFIG.section3.words[section3Data.currentWordIndex];
            const word = wordData.word;
            
            document.getElementById('currentWord').textContent = section3Data.currentWordIndex + 1;
            document.getElementById('wordHint').textContent = wordData.hint;
            document.getElementById('wrongAttempts').textContent = '0';
            document.getElementById('hangmanDrawing').textContent = '';
            
            // Mostrar palabra con guiones
            document.getElementById('wordDisplay').innerHTML = word.split('').map(letter => 
                letter === ' ' ? '&nbsp;&nbsp;' : '_'
            ).join(' ');
            
            // Crear botones de letras
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            document.getElementById('letterButtons').innerHTML = alphabet.split('').map(letter => `
                <button class="hangman-letter bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-2 md:px-3 rounded transition-colors duration-200 text-sm md:text-base" 
                        onclick="guessLetter('${letter}')" data-letter="${letter}">
                    ${letter}
                </button>
            `).join('');
            
            // Resetear variables del juego
            window.currentHangmanWord = word;
            window.guessedLetters = [];
            window.wrongGuesses = 0;
            
            document.getElementById('nextWordBtn').classList.add('hidden');
            document.getElementById('skipWordBtn').classList.remove('hidden');
        }

        function guessLetter(letter) {
            if (window.guessedLetters.includes(letter)) return;
            
            window.guessedLetters.push(letter);
            const button = document.querySelector(`[data-letter="${letter}"]`);
            
            if (window.currentHangmanWord.includes(letter)) {
                button.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                button.classList.add('bg-green-500', 'text-white');
                updateWordDisplay();
            } else {
                button.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                button.classList.add('bg-red-500', 'text-white');
                window.wrongGuesses++;
                section3Data.totalAttempts++;
                document.getElementById('wrongAttempts').textContent = window.wrongGuesses;
                updateHangmanDrawing();
            }
            
            button.disabled = true;
            button.classList.add('cursor-not-allowed');
            
            checkHangmanWin();
        }

        function updateWordDisplay() {
            const word = window.currentHangmanWord;
            const display = word.split('').map(letter => {
                if (letter === ' ') return '&nbsp;&nbsp;';
                return window.guessedLetters.includes(letter) ? letter : '_';
            }).join(' ');
            
            document.getElementById('wordDisplay').innerHTML = display;
        }

        function updateHangmanDrawing() {
            const drawings = ['😟', '😰', '😨', '😱', '💀', '☠️'];
            if (window.wrongGuesses <= drawings.length) {
                document.getElementById('hangmanDrawing').textContent = drawings[window.wrongGuesses - 1] || '';
            }
        }

        function checkHangmanWin() {
            const word = window.currentHangmanWord;
            const isComplete = word.split('').every(letter => 
                letter === ' ' || window.guessedLetters.includes(letter)
            );
            
            if (isComplete) {
                section3Data.wordsCompleted++;
                document.getElementById('nextWordBtn').classList.remove('hidden');
                document.getElementById('skipWordBtn').classList.add('hidden');
                
                // Deshabilitar todos los botones de letras
                document.querySelectorAll('.hangman-letter').forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('cursor-not-allowed');
                });
            } else if (window.wrongGuesses >= 6) {
                document.getElementById('nextWordBtn').classList.remove('hidden');
                document.getElementById('skipWordBtn').classList.add('hidden');
                
                // Mostrar la palabra completa
                document.getElementById('wordDisplay').innerHTML = word.split('').join(' ');
                
                // Deshabilitar todos los botones de letras
                document.querySelectorAll('.hangman-letter').forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('cursor-not-allowed');
                });
            }
        }

        function skipWord() {
            section3Data.totalAttempts += 6; // Penalización por saltar
            nextWord();
        }

        function nextWord() {
            if (section3Data.currentWordIndex < EVALUATION_CONFIG.section3.words.length - 1) {
                section3Data.currentWordIndex++;
                loadHangmanWord();
            } else {
                // Mostrar resultados
                showResults();
            }
        }

        // Función para generar hash de seguridad
        function generateSecurityHash(data) {
            // Función simple de hash para crear un identificador único
            let hash = 0;
            const str = JSON.stringify(data);
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convertir a 32-bit integer
            }
            return Math.abs(hash).toString(16).toUpperCase();
        }

        // Función para generar código QR
        function generateQRCode(evaluationData) {
            const qrContainer = document.getElementById('qrcode');
            
            try {
                // Crear datos estructurados para el QR
                const qrData = {
                    estudiante: evaluationData.name,
                    grupo: evaluationData.group,
                    fecha: evaluationData.date,
                    hora: evaluationData.time,
                    tiempo_total: evaluationData.totalTime,
                    seccion1: `${evaluationData.section1Score}%`,
                    seccion2: `${evaluationData.section2Score}%`,
                    seccion3: `${evaluationData.section3Score}%`,
                    calificacion_final: `${evaluationData.finalScore}%`,
                    intento: evaluationData.attempt,
                    profesor: EVALUATION_CONFIG.general.professor,
                    materia: EVALUATION_CONFIG.general.subtitle,
                    hash: generateSecurityHash(evaluationData)
                };

                // Convertir a texto compacto para el QR
                const qrText = JSON.stringify(qrData);
                
                // Limpiar contenedor
                qrContainer.innerHTML = '';
                
                // Crear canvas para el QR
                const canvas = document.createElement('canvas');
                qrContainer.appendChild(canvas);
                
                // Generar QR usando QRious
                const qr = new QRious({
                    element: canvas,
                    value: qrText,
                    size: 200,
                    background: '#ffffff',
                    foreground: '#1e40af',
                    level: 'M'
                });
                
                console.log('QR generado exitosamente con QRious');
                
                // Almacenar datos para descarga
                window.currentQRData = qrData;
                window.currentQRCanvas = canvas;
                
            } catch (error) {
                console.error('Error generando QR:', error);
                
                // Fallback: generar QR usando API externa
                generateQRCodeFallback(evaluationData);
            }
        }

        // Función de respaldo para generar QR usando API externa
        function generateQRCodeFallback(evaluationData) {
            const qrContainer = document.getElementById('qrcode');
            
            try {
                // Crear datos más compactos para la API
                const qrData = {
                    est: evaluationData.name,
                    grp: evaluationData.group,
                    fec: evaluationData.date,
                    hor: evaluationData.time,
                    tmp: evaluationData.totalTime,
                    s1: evaluationData.section1Score,
                    s2: evaluationData.section2Score,
                    s3: evaluationData.section3Score,
                    fin: evaluationData.finalScore,
                    int: evaluationData.attempt,
                    prof: EVALUATION_CONFIG.general.professor,
                    hash: generateSecurityHash(evaluationData).substring(0, 8)
                };

                const qrText = encodeURIComponent(JSON.stringify(qrData));
                
                // Usar API de QR Server
                const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${qrText}&color=1e40af&bgcolor=ffffff`;
                
                qrContainer.innerHTML = `
                    <img src="${qrUrl}" 
                         alt="Código QR de Verificación" 
                         class="w-50 h-50 border border-gray-300 rounded-lg"
                         onload="handleQRImageLoad(this)"
                         onerror="handleQRImageError(this)">
                `;
                
                // Almacenar datos para descarga
                window.currentQRData = qrData;
                window.currentQRUrl = qrUrl;
                
            } catch (error) {
                console.error('Error en fallback QR:', error);
                showQRError();
            }
        }

        // Función para manejar carga exitosa de imagen QR
        function handleQRImageLoad(img) {
            console.log('QR cargado exitosamente usando API externa');
            showNotification('Código QR generado correctamente', 'success');
        }

        // Función para manejar error de imagen QR
        function handleQRImageError(img) {
            console.error('Error cargando imagen QR');
            showQRError();
        }

        // Función para mostrar error en QR
        function showQRError() {
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = `
                <div class="text-red-600 text-center p-4 border border-red-300 rounded-lg bg-red-50">
                    <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p class="text-sm font-medium">Error al generar código QR</p>
                    <p class="text-xs mt-1">Los datos están disponibles en el resumen</p>
                </div>
            `;
        }

        // Función para descargar el código QR
        function downloadQR() {
            try {
                // Intentar descargar desde canvas (QRious)
                const canvas = document.querySelector('#qrcode canvas');
                if (canvas && window.currentQRData) {
                    downloadQRFromCanvas(canvas);
                    return;
                }
                
                // Intentar descargar desde imagen (API externa)
                const img = document.querySelector('#qrcode img');
                if (img && window.currentQRUrl) {
                    downloadQRFromImage(img);
                    return;
                }
                
                // Si no hay QR disponible
                showNotification('No hay código QR disponible para descargar', 'error');
                
            } catch (error) {
                console.error('Error descargando QR:', error);
                showNotification('Error al descargar el código QR', 'error');
            }
        }

        // Función para descargar QR desde canvas
        function downloadQRFromCanvas(canvas) {
            try {
                // Crear un canvas más grande con información adicional
                const downloadCanvas = document.createElement('canvas');
                const ctx = downloadCanvas.getContext('2d');
                
                // Configurar tamaño del canvas de descarga
                downloadCanvas.width = 400;
                downloadCanvas.height = 500;
                
                // Fondo blanco
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, downloadCanvas.width, downloadCanvas.height);
                
                // Título
                ctx.fillStyle = '#1e40af';
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('EVALUACIÓN DIGITAL', downloadCanvas.width / 2, 30);
                
                ctx.font = '14px Arial';
                ctx.fillText('Tecnologías para Manejo Masivo de Datos', downloadCanvas.width / 2, 50);
                
                // Dibujar el QR en el centro
                const qrSize = 200;
                const qrX = (downloadCanvas.width - qrSize) / 2;
                const qrY = 70;
                ctx.drawImage(canvas, qrX, qrY, qrSize, qrSize);
                
                // Información adicional
                ctx.fillStyle = '#374151';
                ctx.font = '12px Arial';
                ctx.textAlign = 'left';
                
                const studentName = window.currentQRData.estudiante || window.currentQRData.est || 'N/A';
                const studentGroup = window.currentQRData.grupo || window.currentQRData.grp || 'N/A';
                const evalDate = window.currentQRData.fecha || window.currentQRData.fec || 'N/A';
                const finalScore = window.currentQRData.calificacion_final || `${window.currentQRData.fin}%` || 'N/A';
                const hash = window.currentQRData.hash || 'N/A';
                
                const info = [
                    `Estudiante: ${studentName}`,
                    `Grupo: ${studentGroup}`,
                    `Fecha: ${evalDate}`,
                    `Calificación: ${finalScore}`,
                    `Hash: ${hash}`
                ];
                
                let yPos = qrY + qrSize + 30;
                info.forEach(line => {
                    ctx.fillText(line, 20, yPos);
                    yPos += 20;
                });
                
                // Pie de página
                ctx.fillStyle = '#6b7280';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Código QR de verificación - MTI JERM', downloadCanvas.width / 2, downloadCanvas.height - 20);
                
                // Descargar
                const link = document.createElement('a');
                const fileName = `QR_Evaluacion_${studentName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.png`;
                link.download = fileName;
                link.href = downloadCanvas.toDataURL('image/png');
                link.click();
                
                showNotification('¡Código QR descargado exitosamente!', 'success');
                
            } catch (error) {
                console.error('Error en downloadQRFromCanvas:', error);
                showNotification('Error al procesar la descarga del QR', 'error');
            }
        }

        // Función para descargar QR desde imagen
        function downloadQRFromImage(img) {
            try {
                // Crear canvas temporal para procesar la imagen
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                
                tempCanvas.width = img.naturalWidth || 200;
                tempCanvas.height = img.naturalHeight || 200;
                
                // Dibujar la imagen en el canvas temporal
                tempCtx.drawImage(img, 0, 0);
                
                // Crear canvas de descarga
                const downloadCanvas = document.createElement('canvas');
                const ctx = downloadCanvas.getContext('2d');
                
                downloadCanvas.width = 400;
                downloadCanvas.height = 500;
                
                // Fondo blanco
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, downloadCanvas.width, downloadCanvas.height);
                
                // Título
                ctx.fillStyle = '#1e40af';
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('EVALUACIÓN DIGITAL', downloadCanvas.width / 2, 30);
                
                ctx.font = '14px Arial';
                ctx.fillText('Tecnologías para Manejo Masivo de Datos', downloadCanvas.width / 2, 50);
                
                // Dibujar el QR
                const qrSize = 200;
                const qrX = (downloadCanvas.width - qrSize) / 2;
                const qrY = 70;
                ctx.drawImage(tempCanvas, qrX, qrY, qrSize, qrSize);
                
                // Información adicional
                ctx.fillStyle = '#374151';
                ctx.font = '12px Arial';
                ctx.textAlign = 'left';
                
                const studentName = window.currentQRData.est || 'N/A';
                const studentGroup = window.currentQRData.grp || 'N/A';
                const evalDate = window.currentQRData.fec || 'N/A';
                const finalScore = `${window.currentQRData.fin}%` || 'N/A';
                const hash = window.currentQRData.hash || 'N/A';
                
                const info = [
                    `Estudiante: ${studentName}`,
                    `Grupo: ${studentGroup}`,
                    `Fecha: ${evalDate}`,
                    `Calificación: ${finalScore}`,
                    `Hash: ${hash}`
                ];
                
                let yPos = qrY + qrSize + 30;
                info.forEach(line => {
                    ctx.fillText(line, 20, yPos);
                    yPos += 20;
                });
                
                // Pie de página
                ctx.fillStyle = '#6b7280';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Código QR de verificación - MTI JERM', downloadCanvas.width / 2, downloadCanvas.height - 20);
                
                // Descargar
                const link = document.createElement('a');
                const fileName = `QR_Evaluacion_${studentName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.png`;
                link.download = fileName;
                link.href = downloadCanvas.toDataURL('image/png');
                link.click();
                
                showNotification('¡Código QR descargado exitosamente!', 'success');
                
            } catch (error) {
                console.error('Error en downloadQRFromImage:', error);
                // Fallback: descargar directamente la URL de la imagen
                const link = document.createElement('a');
                link.download = `QR_Evaluacion_${new Date().toISOString().split('T')[0]}.png`;
                link.href = window.currentQRUrl;
                link.click();
                
                showNotification('Código QR descargado (versión simple)', 'success');
            }
        }

        // Función para mostrar resultados
        function showResults() {
            const finalTime = stopTimer();
            
            // Incrementar contador de intentos al completar la evaluación
            const currentAttempt = incrementAttemptCount();
            
            // Obtener fecha y hora actual
            const now = new Date();
            const evaluationDate = now.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const evaluationTime = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // Calcular puntuaciones usando ponderaciones del JSON
            const section1Score = (section1Answers.filter((answer, index) => answer === questionMappings[index].correct).length / questionMappings.length) * 100;
            
            let section2Score = 0;
            const totalPairs = Object.keys(EVALUATION_CONFIG.section2.pairs).length;
            Object.keys(EVALUATION_CONFIG.section2.pairs).forEach(concept => {
                if (section2Connections[concept] === EVALUATION_CONFIG.section2.pairs[concept]) {
                    section2Score += (100 / totalPairs); // Distribuir 100% entre todos los pares
                }
            });
            
            const section3Score = Math.max(0, (section3Data.wordsCompleted / EVALUATION_CONFIG.section3.words.length) * 100 - (section3Data.totalAttempts * 2));
            
            // Usar ponderaciones del JSON para calcular puntuación final
            const finalScore = (section1Score * (EVALUATION_CONFIG.section1.weight / 100)) + 
                              (section2Score * (EVALUATION_CONFIG.section2.weight / 100)) + 
                              (section3Score * (EVALUATION_CONFIG.section3.weight / 100));
            
            // Mostrar resultados
            document.getElementById('section3').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            document.getElementById('finalName').textContent = studentData.name;
            document.getElementById('finalGroup').textContent = studentData.group;
            document.getElementById('finalTime').textContent = finalTime;
            document.getElementById('evaluationDate').textContent = evaluationDate;
            document.getElementById('evaluationTime').textContent = evaluationTime;
            document.getElementById('attemptNumber').textContent = currentAttempt;
            document.getElementById('section1Score').textContent = `${Math.round(section1Score)}%`;
            document.getElementById('section2Score').textContent = `${Math.round(section2Score)}%`;
            document.getElementById('section3Score').textContent = `${Math.round(section3Score)}%`;
            document.getElementById('finalScore').textContent = `${Math.round(finalScore)}%`;
            
            // Generar código QR con todos los datos
            const evaluationData = {
                name: studentData.name,
                group: studentData.group,
                date: evaluationDate,
                time: evaluationTime,
                totalTime: finalTime,
                section1Score: Math.round(section1Score),
                section2Score: Math.round(section2Score),
                section3Score: Math.round(section3Score),
                finalScore: Math.round(finalScore),
                attempt: currentAttempt,
                timestamp: now.getTime()
            };
            
            // Generar QR después de un pequeño delay para asegurar que el DOM esté listo
            setTimeout(() => {
                generateQRCode(evaluationData);
            }, 500);
        }



        // Inicializar la aplicación cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Evaluación Digital cargada correctamente');
            console.log('Configuración JSON:', EVALUATION_CONFIG);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9843b08904ca127d',t:'MTc1ODczMTY3MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
